# AI 인사이트 엔진 프롬프트 전면 개선 완료

## 개요
PAL 앱의 Cloud Functions 인사이트 엔진을 전면 개선하여, 단순한 상태 보고에서 **구체적이고 실행 가능한 조언**으로 업그레이드했습니다.

## 주요 개선 사항

### 1. 메시지 템플릿 개선 (insightConfig.ts)

#### 회원용 메시지 (토스 해요체, 동기부여 중심)

**이전:**
- "목표 90% 달성! 거의 다 왔어요"
- "체중이 줄었습니다"

**개선 후:**
- "목표 90% 달성! 2.1kg만 더 가면 성공이에요 💪"
- "4주간 체지방 4.2kg↓ 근육 0.8kg↑ 완벽한 다이어트예요! 💯"
- "현재 속도면 5주 후 목표 달성이에요"
- "벤치프레스 4주간 15kg 향상! 빠르게 성장 중이에요 🔥"

#### 트레이너용 메시지 (토스 해요체, 액션 중심)

**이전:**
- "김민수님 이탈 위험 높음"
- "회원에게 연락하세요"

**개선 후:**
- "김민수님 이탈 위험 매우 높아요! 출석률 40% 하락, 2주 체중 정체 - 이번 주 연락 권장해요"
- "이수진님 PT 5일 남음 - 세션 충실히 이용 중 재등록 제안 타이밍이에요"
- "즉시 전화 연락 권장: '안녕하세요! 요즘 어떠세요? 운동 스케줄 함께 조정해봐요'"

### 2. 트레이너 인사이트 개선 (generateInsights.ts)

#### 출석 경고
- **추가:** 주간 출석 추이 그래프 데이터
- **개선:** 구체적인 격려 메시지 예시 제공
- "이번 주 중 격려 메시지를 보내보세요. 예: '요즘 어떠세요? 함께 목표 달성해봐요!'"

#### PT 만료 알림
- **추가:** 세션 이용률 계산 (80% 이상이면 재등록 타이밍)
- **개선:** 남은 세션 수와 실천 가능한 액션 제안
- "5회 빠르게 소진할 수 있도록 일정 제안하세요"
- "재등록 제안 타이밍: '지금까지 잘 하셨어요. 다음 단계로 가볼까요?'"

#### 체중 변화 분석
- **추가:** 기간(주차) 정보, 목표까지 남은 양
- **개선:** 목표 달성 시 구체적인 축하 메시지 템플릿
- "축하 메시지: '8주간 5.2kg 변화! 정말 잘하셨어요 🎉 다음 목표를 함께 정해봐요'"

#### 이탈 위험 분석
- **개선:** 상위 2개 위험 요소 강조
- **개선:** 위험도별 구체적 연락 방법 제안
- CRITICAL: "즉시 전화 연락 + 구체적 스크립트"
- HIGH: "이번 주 중 연락 + 해결 방법"
- MEDIUM: "체크인 메시지 템플릿"

#### 재등록 가능성
- **추가:** 진행 상황 메시지 (목표 80% 달성 등)
- **개선:** 재등록 확률에 따른 맞춤 제안
- 80% 이상: "목표까지 함께 완주해요! 다음 단계 프로그램 준비했어요"
- 60-79%: "지금까지 65% 달성! 목표 완성까지 함께 가요"

#### 수익 분석 (NEW)
- **신규 기능:** 월별 수익 추적
- "이번 달 32회 완료, 예상 수입 480만원 (지난달 대비 +12%)"
- "이번 주 8회 완료 - 4회 남았어요"

### 3. 회원 인사이트 개선 (generateMemberInsights.ts)

#### 체성분 예측
- **추가:** 주간 변화율, 목표 도달까지 소요 주차
- "현재 속도면 4주 후 3.2kg 감량 예상! 주 0.8kg씩 줄고 있어요"
- "5주 후 목표 체중 70kg 도달 예상! 🎯"

#### 운동 성과
- **추가:** 개선 기간(몇 주간) 정보
- "스쿼트 4주간 20kg 향상! 빠르게 성장 중이에요 🔥"
- "다음 목표는 100kg이에요"

#### 출석 습관
- **추가:** 연속 출석 주차 계산
- **추가:** 마지막 운동 후 경과 일수
- "출석률 90% - 3주 연속 성실! 상위권이에요 🌟"
- "14일째 운동 안했어요 - 오늘 다시 시작해봐요!"

#### 영양 밸런스
- **추가:** 부족 영양소와 구체적 식품 제안
- "단백질 하루 30g 부족해요. 닭가슴살 100g 추가하면 채울 수 있어요"
- "단백질 하루 120g 섭취 중 - 근육 성장에 이상적이에요!"

#### 체성분 변화
- **추가:** 기간(몇 주간), 체지방률 변화
- "8주간 체지방 4.2kg↓ 근육 0.8kg↑ 완벽한 다이어트예요! 💯"
- "4주간 체지방률 3.5% 감소! 몸이 확실히 변하고 있어요"

#### 목표 달성률
- **추가:** 목표까지 남은 양, 예상 소요 주차, 주간 변화율
- "목표 90% 달성! 2.1kg만 더 가면 성공이에요 💪"
- "목표 65% 달성 중! 현재 속도면 5주 후 목표 달성이에요"

#### 벤치마킹
- **개선:** 더 구체적이고 동기부여되는 메시지
- "남성 30s 다이어트 회원 150명 중 상위 15%예요! 🏆 출석률도 상위 20% - 정말 열심히 하고 있어요"
- "출석률 70%에서 10%만 더 높이면 상위권 진입이에요!"

#### 주간 요약 (NEW)
- **신규 기능:** 주간 운동 횟수와 체중 변화 요약
- "이번 주 4회 운동 완료! 체중 1.2kg 감량 최고예요 🏆"
- "이번 주 2회 운동 - 목표 3회까지 조금 더!"

#### 휴식 권장 (NEW)
- **신규 기능:** 연속 운동일 감지 및 휴식 제안
- "5일 연속 운동했어요! 오늘은 스트레칭하고 쉬는 게 어때요?"
- 근육 회복을 위한 능동적 휴식 가이드

## 기술적 개선

### 1. 데이터 활용 강화
- **그래프 데이터:** 주간 추이, 트렌드 데이터 추가
- **계산 로직:** 백분율, 변화율, 예상 소요 기간 등 구체적 수치 계산
- **기간 정보:** "4주간", "8주간" 등 시간 맥락 제공

### 2. 조건부 메시지
- 데이터 충분도에 따른 fallback 메시지
- 목표 유형(다이어트/벌크업)에 따른 맞춤 메시지
- 우선순위에 따른 액션 강도 차별화

### 3. 실행 가능한 액션 제안
- "~하세요" → "~해보세요. 예: [구체적 스크립트]"
- 단순 알림 → 실천 가능한 다음 단계 제시
- 숫자 기반 명확한 목표 제시

## 메시지 스타일 통일

### 토스 해요체
- "~입니다" → "~이에요"
- "~하십시오" → "~해보세요"
- "권장합니다" → "권장해요"

### 동기부여 요소
- 이모지 사용 (💪 🔥 🎉 🏆 🌟)
- 긍정적 프레이밍
- 구체적 칭찬과 격려

### 실행 중심
- "확인하세요" → "메시지 보내보세요: '[예시 메시지]'"
- "주의 필요" → "이번 주 중 연락 권장해요"
- "고려 바람" → "~해봐요"

## 영향

### 트레이너
- **이탈 방지:** 위험 징후 조기 감지 + 즉시 실행 가능한 개입 방법
- **재등록 증대:** 최적 타이밍 + 효과적인 제안 스크립트
- **수익 가시화:** 월별/주별 수익 추적으로 목표 관리
- **업무 효율:** 우선순위 명확 + 구체적 액션 가이드

### 회원
- **동기부여:** 구체적 수치와 예측으로 목표 실감
- **진행 상황 가시화:** "5주 후 목표 달성" 같은 명확한 이정표
- **실천 가능한 조언:** "닭가슴살 100g 추가" 같은 즉시 적용 가능한 팁
- **사회적 비교:** "상위 15%" 같은 벤치마킹으로 경쟁심 자극

## 개선된 파일 목록

1. **functions/src/constants/insightConfig.ts**
   - MEMBER_MESSAGE_TEMPLATES 전면 개선
   - TRAINER_MESSAGE_TEMPLATES 전면 개선
   - 새로운 메시지 타입 추가 (rest_needed, weekly_summary, revenue)

2. **functions/src/generateInsights.ts**
   - analyzeAttendancePattern 개선
   - analyzePTExpiry 개선
   - analyzeWeightProgress 개선
   - analyzeChurnRisk 개선
   - analyzeRenewalLikelihood 개선
   - analyzeRevenueProgress 신규 추가

3. **functions/src/generateMemberInsights.ts**
   - generateBodyPrediction 개선
   - generateWorkoutAchievement 개선
   - generateAttendanceHabit 개선
   - generateNutritionBalance 개선
   - generateBodyChangeReport 개선
   - generateGoalProgress 개선
   - generateBenchmarking 개선
   - generateWeeklySummary 신규 추가
   - generateRestRecommendation 신규 추가

## 빌드 상태
✅ TypeScript 빌드 성공
✅ 기존 함수 시그니처 유지
✅ 기존 인터페이스 호환성 유지

## 다음 단계 권장사항

1. **A/B 테스팅:** 기존 메시지 vs 개선된 메시지 효과 비교
2. **사용자 피드백:** 트레이너와 회원의 메시지 이해도 및 만족도 조사
3. **추가 인사이트:** 식단 패턴 분석, 수면/컨디션 연동 등
4. **알림 최적화:** 인사이트 푸시 알림 타이밍 최적화
5. **AI 고도화:** GPT-4 기반 개인화된 조언 생성 고려

## 결론

단순한 "상태 알림"에서 **"실행 가능한 인텔리전스"**로 진화했습니다. 트레이너는 더 효과적으로 회원을 관리할 수 있고, 회원은 더 명확한 목표와 동기부여를 얻게 됩니다.
